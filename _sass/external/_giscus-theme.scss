@use "../colors";
@use "sass:color";

main {
  --color-prettylights-syntax-comment: #768390;
  --color-prettylights-syntax-constant: #{colors.$syntax-blue};
  --color-prettylights-syntax-entity: #{colors.$syntax-purple};
  --color-prettylights-syntax-storage-modifier-import: #adbac7;
  --color-prettylights-syntax-entity-tag: #{colors.$syntax-green};
  --color-prettylights-syntax-keyword: #{colors.$syntax-red};
  --color-prettylights-syntax-string: #{colors.$syntax-cyan};
  --color-prettylights-syntax-variable: #{colors.$syntax-orange};
  --color-prettylights-syntax-brackethighlighter-unmatched: #e5534b;
  --color-prettylights-syntax-invalid-illegal-text: #cdd9e5;
  --color-prettylights-syntax-invalid-illegal-bg: #922323;
  --color-prettylights-syntax-carriage-return-text: #cdd9e5;
  --color-prettylights-syntax-carriage-return-bg: #ad2e2c;
  --color-prettylights-syntax-string-regexp: #{colors.$syntax-green};
  --color-prettylights-syntax-markup-list: #{colors.$syntax-yellow};
  --color-prettylights-syntax-markup-heading: #{colors.$syntax-blue};
  --color-prettylights-syntax-markup-italic: #adbac7;
  --color-prettylights-syntax-markup-bold: #adbac7;
  --color-prettylights-syntax-markup-deleted-text: #ffd8d3;
  --color-prettylights-syntax-markup-deleted-bg: #78191b;
  --color-prettylights-syntax-markup-inserted-text: #b4f1b4;
  --color-prettylights-syntax-markup-inserted-bg: #1b4721;
  --color-prettylights-syntax-markup-changed-text: #ffddb0;
  --color-prettylights-syntax-markup-changed-bg: #682d0f;
  --color-prettylights-syntax-markup-ignored-text: #adbac7;
  --color-prettylights-syntax-markup-ignored-bg: #255ab2;
  --color-prettylights-syntax-meta-diff-range: #dcbdfb;
  --color-prettylights-syntax-brackethighlighter-angle: #768390;
  --color-prettylights-syntax-sublimelinter-gutter-mark: #545d68;
  --color-prettylights-syntax-constant-other-reference-link: #{colors.$syntax-cyan};

  --color-fg-default: #{colors.$foreground};
  --color-fg-muted: #{color.change(colors.$foreground, $lightness: 30%)};

  --color-canvas-default: #{colors.$surface-2};
  --color-canvas-overlay: #{colors.$surface-2};
  --color-canvas-inset: #{colors.$surface-3};
  --color-canvas-subtle: #{colors.$surface-1};

  --color-border-default: transparent;
  --color-border-muted: #{rgba(colors.$foreground, 0.1)};

  --color-btn-border: transparent;
  --color-btn-hover-border: transparent;
  --color-btn-active-border: transparent;
  --color-btn-primary-border: transparent;
  --color-btn-primary-hover-border: transparent;
  --color-btn-primary-disabled-border: transparent;

  --color-btn-primary-bg: #{colors.$accent-secondary};
  --color-btn-primary-hover-bg: #{color.adjust(colors.$accent-secondary, $lightness: +5%)};
  --color-btn-primary-selected-bg: #{colors.$accent-secondary};

  --color-btn-bg: #{rgba(colors.$foreground, 0.05)};
  --color-btn-hover-bg: #{rgba(colors.$foreground, 0.1)};
  --color-btn-active-bg: #{rgba(colors.$foreground, 0.05)};

  --color-btn-primary-disabled-bg: #{color.change(colors.$accent-secondary, $alpha: 0.3)};
  --color-btn-primary-disabled-text: #{color.change(colors.$foreground, $alpha: 0.3)};

  --color-accent-muted: transparent;

  --color-accent-emphasis: #{colors.$accent-primary};
  --color-primer-shadow-focus: 0 0 0 2px #{colors.$accent-primary};

  --color-accent-subtle: #{rgba(colors.$accent-primary, 0.1)};
  --color-social-reaction-border: #{rgba(colors.$accent-primary, 0.4)};
  --color-social-reaction-bg-reacted-hover: #{rgba(colors.$accent-primary, 0.2)};
  --color-accent-fg: #{colors.$accent-primary};

  a,
  .link-secondary:hover,
  a:hover .link-primary,
  button.color-text-link,
  .gsc-toolbar-item:hover,
  .gsc-reactions-button:hover,
  .gsc-reactions-button.popover-only:hover {
    color: #{colors.$accent-secondary};
  }

  span.color-box-border-info {
    color: colors.$accent-primary;
    background: var(--color-accent-subtle);
    border: 1px solid var(--color-social-reaction-border);
  }

  button.gsc-social-reaction-summary-item:not(.gsc-reactions-button, .has-reacted) {
    border: 1px solid var(--color-btn-bg);
    background: var(--color-btn-bg);
    &:hover {
      background: var(--color-btn-hover-bg);
    }
  }

  .gsc-replies {
    background: var(--color-canvas-subtle);
  }

  .gsc-reply-box,
  .gsc-comment-box-main {
    margin: 0;
    padding: 1rem;

    textarea {
      display: block;

      &:focus {
        background: var(--color-canvas-inset);
      }
    }
  }

  .gsc-comment-header {
    padding: 1rem 1rem 0;
  }

  .gsc-comment-box-bottom {
    margin: 0 1rem 1rem;
  }

  .markdown hr {
    background: color.change(colors.$foreground, $alpha: 0.1);
  }

  .gsc-comments .gsc-header {
    padding: 0;
    margin-top: 1rem;
    justify-content: end;

    h4 {
      font-weight: normal;
    }
  }

  .gsc-reactions-menu {
    --popover-bg: #{color.adjust(colors.$surface-1, $lightness: +10%)};

    display: flex;
    align-items: center;

    .gsc-reactions-popover {
      background: var(--popover-bg);
      margin: 0;
      width: auto;
      border: 0;
      padding: 0.3rem;

      &.popover {
        left: 100%;
      }

      &.popover-only {
        right: calc(100% + 0.5rem);
      }

      > p,
      > .border-t {
        display: none;
      }

      > div {
        margin: 0;
      }

      .gsc-emoji-button {
        height: auto;
        width: auto;
        padding: 0.3rem;
        margin: 0;
        border-radius: 5px;

        &.has-reacted {
          background: var(--color-btn-active-bg);
        }
      }

      > div:last-child {
        display: flex;
        flex-direction: row;
        gap: 0.3rem;
      }

      &.open {
        &.popover,
        &.popover-only {
          &::before {
            content: "";
            border: 8px solid transparent;
            top: calc(50% - 8px);
          }

          &::after {
            content: initial;
          }
        }

        &.popover::before {
          border-right-color: var(--popover-bg);
          left: -16px;
        }

        &.popover-only::before {
          border-left-color: var(--popover-bg);
          right: -16px;
        }
      }
    }
  }

  .gsc-reactions .gsc-reactions-menu {
    --popover-bg: #{color.adjust(colors.$surface-3, $lightness: +10%)};
  }

  .gsc-comment-reactions .gsc-reactions-menu {
    --popover-bg: #{color.adjust(colors.$surface-2, $lightness: +10%)};
  }

  .gsc-reactions {
    position: absolute;
    margin: 1rem 0 0 0;

    display: flex;
    flex-direction: row-reverse;
    align-items: center;

    > div {
      margin-top: 0;
    }

    .gsc-reactions-count {
      display: none;
    }

    .gsc-direct-reaction-button {
      margin: 0 0.5rem 0 0;
    }

    .gsc-reactions-button {
      font-size: 1em;
    }
  }
}
